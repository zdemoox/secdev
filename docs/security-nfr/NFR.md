# Security NFR — Study Planner (FastAPI)

Ниже — измеримые **Security NFR** (non‑functional requirements) для проекта **Study Planner** (API планировщика учебных тем).
Каждый NFR содержит **метрику/порог** и **способ проверки** (как это измерить и где).
> Примечание: часть требований относится к будущим модулям (auth/users), но фиксируется заранее, чтобы привязать к бэклогу и приёмке.

| ID     | Название | Описание | Метрика/Порог | Проверка (чем/где) | Компонент | Приоритет |
|--------|----------|----------|---------------|--------------------|-----------|-----------|
| NFR-01 | Транспортное шифрование | Все внешние соединения только по TLS | HTTPS-only; TLS >= 1.2; HSTS включён | Проверка ingress/reverse-proxy конфигурации + curl на stage | platform | High |
| NFR-02 | Единый формат ошибок без утечек | Ошибки не раскрывают PII/секреты; единый envelope | 100% endpoint’ов возвращают `{error:{code,message}}`; PII отсутствует в `message` | Контракт-тесты на ответы (pytest) | api | High |
| NFR-03 | Валидация входных данных | Некорректные данные не приводят к 500 и не проходят в бизнес‑логику | 100% invalid → 4xx; доля 5xx <= 0.1% | Набор негативных тестов (pytest) + отчёт CI | api | High |
| NFR-04 | Rate limiting | Ограничение частоты запросов на клиента | >= 60 req/min/IP; превышение → 429 | Конфиг middleware/API‑gateway + интеграционный тест (stage) | platform | Medium |
| NFR-05 | Логи без секретов и с корреляцией | Нельзя логировать токены/секреты; запросы имеют correlation id | 0 утечек секретов; 100% запросов имеют `X-Request-Id`/`correlation_id` | Политика логирования + проверка формата логов | api | Medium |
| NFR-06 | SLA по уязвимостям зависимостей | Уязвимости зависимостей устраняются в срок | Critical/High: <= 7 дней; Medium: <= 30 дней | SCA (Dependabot/OSV) отчёт в PR + политика блокировки | build | High |
| NFR-07 | Секреты и конфигурация | Секреты не хранятся в репозитории; управляются безопасно | 0 секретов в git; ротация ключей <= 30 дней (если применимо) | gitleaks/semgrep в CI + аудит secret manager | platform | High |
| NFR-08 | Доступность API | Доступность сервиса по SLA | Uptime >= 99.5% / месяц | Мониторинг `/health` + алёрты по SLO | platform | Medium |
| NFR-09 | Производительность списка тем | Чтение списка тем не деградирует при типичной нагрузке | p95 GET /topics <= 250 ms @ 50 RPS (stage) | Нагрузочный тест (k6/locust) + отчёт | api | Medium |
| NFR-10 | Целостность данных | Операции изменения атомарны (без частичных записей) | 0 частичных записей; идемпотентность PATCH по `status` | Интеграционные тесты + (при DB) транзакции | storage/api | Medium |
